<!-- only the <script> part shown â€” replace the current script in login.html with this -->
<script>
const api = (path, opts) => fetch('/api/' + path, opts);

async function safeJson(resp) {
  const text = await resp.text();
  try { return JSON.parse(text); }
  catch(e) { return { ok: false, error: 'invalid server response' }; }
}

document.getElementById('registerBtn').onclick = async () => {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const res = await api('register', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({username, password})});
  const data = await safeJson(res);
  if (data.ok) {
    localStorage.setItem('user', JSON.stringify(data.user));
    location.href = '/index.html';
  } else {
    document.getElementById('msg').innerText = data.error || 'Error';
  }
};

document.getElementById('loginBtn').onclick = async () => {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const res = await api('login', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({username, password})});
  const data = await safeJson(res);
  if (data.ok) {
    localStorage.setItem('user', JSON.stringify(data.user));
    location.href = '/index.html';
  } else {
    document.getElementById('msg').innerText = data.error || 'Invalid';
  }
};
</script>
